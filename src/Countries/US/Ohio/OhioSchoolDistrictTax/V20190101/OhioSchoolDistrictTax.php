<?php

namespace Appleton\Taxes\Countries\US\Ohio\OhioSchoolDistrictTax\V20190101;

use Appleton\Taxes\Countries\US\Ohio\OhioSchoolDistrictTax\OhioSchoolDistrictTax as BaseOhioSchoolDistrictTax;
use Appleton\Taxes\Traits\HasWageBase;
use Illuminate\Database\Eloquent\Collection;

class OhioSchoolDistrictTax extends BaseOhioSchoolDistrictTax
{
    use HasWageBase;

    protected $tax_rate;

    const WAGE_BASE = 9500;

    const TRADITIONAL_TAX_BASE_SCHOOL_ID = [
        3301 => ['Ada EVSD', 0.015, false],
        7501 => ['Anna LSD', 0.015, false],
        1901 => ['Ansonia LSD', 0.0175, false],
        6301 => ['Antwerp LSD', 0.015, false],
        3201 => ['Arcadia LSD', 0.01, false],
        1902 => ['Arcanum-Butler LSD', 0.015, false],
        3202 => ['Arlington LSD', 0.0125, false],
        2001 => ['Ayersville LSD', 0.01, false],
        3901 => ['Bellevue CSD', 0.005, false],
        2501 => ['Bexley CSD', 0.0075, false],
        2101 => ['Big Walnut LSD', 0.0075, false],
        2303 => ['Bloom-Carroll LSD', 0.0125, false],
        203 => ['Bluffton EVSD', 0.005, false],
        8701 => ['Bowling Green CSD', 0.005, false],
        5502 => ['Bradford EVSD', 0.0175, false],
        8601 => ['Bryan CSD', 0.01, false],
        1701 => ['Buckeye Central LSD', 0.015, false],
        2102 => ['Buckeye Valley LSD', 0.01, false],
        2502 => ['Canal Winchester LSD', 0.0075, false],
        8801 => ['Carey EVSD', 0.01, false],
        8301 => ['Carlisle LSD', 0.01, false],
        2902 => ['Cedar Cliff LSD', 0.0125, false],
        4201 => ['Centerburg LSD', 0.0075, false],
        2002 => ['Central LSD', 0.0075, false],
        1303 => ['Clermont-Northeastern LSD', 0.01, false],
        5402 => ['Coldwater EVSD', 0.005, false],
        1703 => ['Colonel Crawford LSD', 0.0125, false],
        1502 => ['Columbiana EVSD', 0.01, false],
        6901 => ['Columbus Grove LSD', 0.01, false],
        6902 => ['Continental LSD', 0.01, false],
        3203 => ['Cory-Rawson LSD', 0.0175, false],
        5503 => ['Covington EVSD', 0.02, false],
        1503 => ['Crestview LSD', 0.01, false],
        8101 => ['Crestview LSD', 0.01, false],
        8502 => ['Dalton LSD', 0.0075, false],
        4202 => ['Danville LSD', 0.015, false],
        2003 => ['Defiance CSD', 0.005, false],
        6803 => ['Eaton CSD', 0.015, false],
        8602 => ['Edgerton LSD', 0.01, false],
        8703 => ['Elmwood LSD', 0.0125, false],
        2602 => ['Evergreen LSD', 0.0175, false],
        8001 => ['Fairbanks LSD', 0.01, false],
        2903 => ['Fairborn CSD', 0.005, false],
        2304 => ['Fairfield Union LSD', 0.02, false],
        7503 => ['Fairlawn LSD', 0.0075, false],
        7504 => ['Fort Loramie LSD', 0.015, false],
        5406 => ['Fort Recovery LSD', 0.015, false],
        1903 => ['Franklin Monroe LSD', 0.0075, false],
        7202 => ['Fremont CSD', 0.0125, false],
        2603 => ['Gorham Fayette LSD', 0.01, false],
        1305 => ['Goshen LSD', 0.01, false],
        2904 => ['Greeneview LSD', 0.01, false],
        1904 => ['Greenville CSD', 0.005, false],
        7505 => ['Hardin-Houston LSD', 0.0075, false],
        3302 => ['Hardin Northern LSD', 0.0175, false],
        2004 => ['Hicksville EVSD', 0.0075, false],
        5902 => ['Highland LSD', 0.005, false],
        3604 => ['Hillsboro CSD', 0.01, false],
        3501 => ['Holgate LSD', 0.015, false],
        6903 => ['Jennings LSD', 0.0075, false],
        4503 => ['Johnstown-Monroe LSD', 0.01, false],
        6904 => ['Kalida LSD', 0.01, false],
        3303 => ['Kenton CSD', 0.01, false],
        7204 => ['Lakota LSD', 0.015, false],
        6905 => ['Leipsic LSD', 0.0075, false],
        3205 => ['Liberty-Benton LSD', 0.0075, false],
        3502 => ['Liberty Center LSD', 0.0175, false],
        2306 => ['Liberty Union-Thurston LSD', 0.0175, false],
        4506 => ['Licking Valley LSD', 0.01, false],
        4903 => ['London CSD', 0.01, false],
        303 => ['Loudonville-Perrysville EVSD', 0.0125, false],
        905 => ['Madison LSD', 0.005, false],
        3206 => ['McComb LSD', 0.015, false],
        1102 => ['Mechanicsburg EVSD', 0.015, false],
        8604 => ['Millcreek-West Unity LSD', 0.01, false],
        6906 => ['Miller City-New Cleveland LSD', 0.0125, false],
        601 => ['Minster LSD', 0.01, false],
        1905 => ['Mississinawa Valley LSD', 0.0175, false],
        8802 => ['Mohawk LSD', 0.01, false],
        5903 => ['Mount Gilead EVSD', 0.0075, false],
        6802 => ['National Trail LSD', 0.0175, false],
        602 => ['New Bremen LSD', 0.01, false],
        603 => ['New Knoxville LSD', 0.0125, false],
        5708 => ['New Lebanon LSD', 0.0125, false],
        3903 => ['New London LSD', 0.01, false],
        907 => ['New Miami LSD', 0.01, false],
        7404 => ['New Riegel LSD', 0.015, false],
        4507 => ['Newark CSD', 0.01, false],
        5506 => ['Newton LSD', 0.0175, false],
        8003 => ['North Union LSD', 0.01, false],
        5904 => ['Northmor LSD', 0.01, false],
        8505 => ['Northwestern LSD', 0.0125, false],
        3904 => ['Norwalk CSD', 0.005, false],
        4712 => ['Oberlin CSD', 0.02, false],
        7405 => ['Old Fort LSD', 0.01, false],
        8707 => ['Otsego LSD', 0.01, false],
        6907 => ['Ottawa-Glandorf LSD', 0.005, false],
        6908 => ['Ottoville LSD', 0.0075, false],
        6909 => ['Pandora-Gilboa LSD', 0.0175, false],
        5405 => ['Parkway LSD', 0.01, false],
        3504 => ['Patrick Henry LSD', 0.0175, false],
        6302 => ['Paulding EVSD', 0.01, false],
        8708 => ['Perrysburg EVSD', 0.005, false],
        2604 => ['Pettisville LSD', 0.01, false],
        2307 => ['Pickerington LSD', 0.01, false],
        5507 => ['Piqua CSD', 0.0125, false],
        7007 => ['Plymouth-Shiloh LSD', 0.01, false],
        6804 => ['Preble Shawnee LSD', 0.01, false],
        2509 => ['Reynoldsburg CSD', 0.005, false],
        3304 => ['Ridgemont LSD', 0.0175, false],
        3305 => ['Riverdale LSD', 0.01, false],
        4604 => ['Riverside LSD', 0.0175, false],
        7507 => ['Russia LSD', 0.0075, false],
        7406 => ['Seneca East LSD', 0.01, false],
        7008 => ['Shelby CSD', 0.01, false],
        3905 => ['South Central LSD', 0.0125, false],
        1205 => ['Southeastern LSD', 0.01, false],
        4510 => ['Southwest Licking LSD', 0.0075, false],
        209 => ['Spencerville LSD', 0.01, false],
        5010 => ['Springfield LSD', 0.01, false],
        8607 => ['Stryker LSD', 0.015, false],
        2606 => ['Swanton LSD', 0.0075, false],
        909 => ['Talawanda CSD', 0.01, false],
        1103 => ['Triad LSD', 0.015, false],
        1906 => ['Tri-Village LSD', 0.015, false],
        6805 => ['Twin Valley Community LSD', 0.015, false],
        7106 => ['Union-Scioto LSD', 0.005, false],
        1510 => ['United LSD', 0.005, false],
        8803 => ['Upper Sandusky EVSD', 0.0125, false],
        3306 => ['Upper Scioto Valley LSD', 0.005, false],
        5713 => ['Valley View LSD', 0.0125, false],
        8104 => ['Van Wert CSD', 0.01, false],
        3208 => ['Vanlue LSD', 0.01, false],
        1907 => ['Versailles EVSD', 0.01, false],
        605 => ['Wapakoneta CSD', 0.0075, false],
        6303 => ['Wayne Trace LSD', 0.0125, false],
        606 => ['Waynesfield-Goshen LSD', 0.01, false],
        4715 => ['Wellington EVSD', 0.01, false],
        1105 => ['West Liberty-Salem LSD', 0.0175, false],
        3906 => ['Western Reserve LSD', 0.0125, false],
        1404 => ['Wilmington CSD', 0.01, false],
        3122 => ['Wyoming CSD', 0.0125, false],
        2906 => ['Xenia Community CSD', 0.005, false],
        2907 => ['Yellow Springs EVSD', 0.01, ],
        0502 => ['Athens CSD', 0.01, true],
        2801 => ['Berkshire LSD', 0.01, true],
        2302 => ['Berne-Union LSD', 0.02, true],
        5501 => ['Bethel LSD', 0.0075, true],
        7502 => ['Botkins LSD', 0.0125, true],
        5901 => ['Cardington-Lincoln LSD', 0.0075, true],
        5401 => ['Celina CSD', 0.0075, true],
        8501 => ['Chippewa LSD', 0.01, true],
        6501 => ['Circleville CSD', 0.0075, true],
        7001 => ['Clear Fork Valley LSD', 0.01, true],
        5204 => ['Cloverleaf LSD', 0.0125, true],
        7201 => ['Clyde-Green Springs EVSD', 0.01, true],
        1704 => ['Crestline EVSD', 0.0025, true],
        8702 => ['Eastwood LSD', 0.01, true],
        8603 => ['Edon-Northwest LSD', 0.01, true],
        5101 => ['Elgin LSD', 0.0075, true],
        7203 => ['Gibsonburg EVSD', 0.0075, true],
        3603 => ['Greenfield EVSD', 0.0125, true],
        0302 => ['Hillsdale LSD', 0.0125, true],
        7403 => ['Hopewell-Loudon LSD', 0.005, true],
        7506 => ['Jackson Center LSD', 0.015, true],
        4901 => ['Jefferson LSD', 0.01, true],
        4902 => ['Jonathan Alder LSD', 0.0125, true],
        2305 => ['Lancaster CSD', 0.015, true],
        6502 => ['Logan Elm LSD', 0.01, true],
        5504 => ['Miami East LSD', 0.0175, true],
        5505 => ['Milton-Union EVSD', 0.0125, true],
        3902 => ['Monroeville LSD', 0.015, true],
        8605 => ['Montpelier EVSD', 0.0125, true],
        8705 => ['North Baltimore LSD', 0.0125, true],
        4508 => ['North Fork LSD', 0.01, true],
        1203 => ['Northeastern LSD', 0.01, true],
        7612 => ['Northwest LSD', 0.01, true],
        1204 => ['Northwestern LSD', 0.01, true],
        8706 => ['Northwood LSD', 0.0025, true],
        8504 => ['Norwayne LSD', 0.0075, true],
        908 => ['Ross LSD', 0.0075, true],
        5008 => ['Sebring LSD', 0.01, true],
        3118 => ['Southwest LSD', 0.0075, true],
        6503 => ['Teays Valley LSD', 0.015, true],
        6806 => ['Tri-County North LSD', 0.01, true],
        8509 => ['Triway LSD', 0.0075, true],
        5509 => ['Troy CSD', 0.015, true],
        2308 => ['Walnut Township LSD', 0.0175, true],
        3907 => ['Willard CSD', 0.0075, true],
        7107 => ['Zane-Trace LSD', 0.0075, true],
    ];

    public function compute(Collection $tax_areas)
    {
        if (!$this->checkSchoolDistrictId($this->tax_information->school_district_id) && is_null($this->tax_information->school_district_id)) {
            return;
        }

        return round($this->getAdjustedEarnings() * $this->tax_rate, 2);
    }

    public function getAdjustedEarnings()
    {
        return min($this->payroll->getEarnings(), $this->getBaseEarnings());
    }

    private function checkSchoolDistrictId($id)
    {
        if (array_key_exists($id, static::TRADITIONAL_TAX_BASE_SCHOOL_ID)) {
            $this->tax_information->school_district_name = static::TRADITIONAL_TAX_BASE_SCHOOL_ID[$id][0];
            $this->tax_rate = static::TRADITIONAL_TAX_BASE_SCHOOL_ID[$id][1];

            return true;
        }
        return false;
    }
}
